#!/bin/sh
. ~/.bash_profile

DATE_TODAY=$1
LOG_FILE=${HOME}/log/${DATE_TODAY}/icps_repair_loan_type__${DATE_TODAY}.log

echo "repair loan type begin" >> ${LOG_FILE}

db2 connect to $DBALIAS user $DBUSER using $DBPASS
db2 "" >> ${LOG_FILE}
db2 "UPDATE LOAN_INFO A SET (A.DGNS_LOAN_TYPE,A.DGNS_LOAN_IN_TYPE) = (SELECT 
CASE  
WHEN DUE_DAYS=0 THEN '2'
WHEN DUE_DAYS BETWEEN 1 AND 30 THEN '3'
WHEN DUE_DAYS BETWEEN 31 AND 90 THEN '4' 
WHEN DUE_DAYS BETWEEN 91 AND 120 THEN '5'
WHEN DUE_DAYS BETWEEN 121 AND 180 THEN '6'
WHEN DUE_DAYS>180 THEN '7'
ELSE '2' END, 
	 CASE  
	 WHEN DUE_DAYS=0 THEN '2'
	 WHEN DUE_DAYS BETWEEN 1 AND 30 THEN '3'
	 WHEN DUE_DAYS BETWEEN 31 AND 90 THEN '4' 
	 WHEN DUE_DAYS BETWEEN 91 AND 180 THEN '5'
	 WHEN DUE_DAYS BETWEEN 181 AND 550 THEN '6'
	 WHEN DUE_DAYS>550 THEN '7'
	 ELSE '2' END 
	 FROM LOAN_INFO B WHERE A.LOAN_ID=B.LOAN_ID  AND A.BUSI_TYPE='WCD' AND B.BUSI_TYPE='WCD')
	 WHERE A.BUSI_TYPE='WCD'" >> ${LOG_FILE}
db2 "UPDATE LOAN_INFO A SET (A.DGNS_LOAN_TYPE,A.DGNS_LOAN_IN_TYPE) = (SELECT 
CASE  
WHEN DUE_DAYS=0 THEN '2'
WHEN DUE_DAYS BETWEEN 1 AND 30 THEN '3'
WHEN DUE_DAYS BETWEEN 31 AND 90 THEN '4' 
WHEN DUE_DAYS BETWEEN 91 AND 120 THEN '5'
WHEN DUE_DAYS BETWEEN 121 AND 180 THEN '6'
WHEN DUE_DAYS>180 THEN '7'
ELSE '2' END, 
	 CASE  
	 WHEN DUE_DAYS=0 THEN '2'
	 WHEN DUE_DAYS BETWEEN 1 AND 30 THEN '3'
	 WHEN DUE_DAYS BETWEEN 31 AND 90 THEN '4' 
	 WHEN DUE_DAYS BETWEEN 91 AND 180 THEN '5'
	 WHEN DUE_DAYS BETWEEN 181 AND 550 THEN '6'
	 WHEN DUE_DAYS>550 THEN '7'
	 ELSE '2' END 
	 FROM LOAN_INFO B WHERE A.LOAN_ID=B.LOAN_ID  AND A.BUSI_TYPE='WLD' AND B.BUSI_TYPE='WLD')
	 WHERE A.BUSI_TYPE='WLD'" >> ${LOG_FILE}
echo "repair loan type finished" >> ${LOG_FILE}
